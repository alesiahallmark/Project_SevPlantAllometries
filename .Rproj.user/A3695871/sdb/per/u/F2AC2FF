{
    "collab_server" : "",
    "contents" : "---\ntitle: \"SEV_VisualizeSmallMammal\"\nauthor: \"AJ\"\ndate: \"10/26/2017\"\noutput: html_document\n---\n\n## Sevilleta Small Mammal Trapping data\n\nThis script makes a few simple plots of small mammal abundance and diversity data from the Sevilleta long-term dataset SEV-8 (Small Mammal Mark-Recapture Population Dynamics at Core Research Sites at the Sevilleta National Wildlife Refuge, New Mexico (1989 - present)). \n\nSites:\n    two22 = two22\n    5pgrass = five points grass\n    5plarrea = five points larrea\n    rsgrass = rio salado grass\n    goatdraw = goat draw\n    bluegram = blue grama\n    savanna = savanna\nSeasons:\n    1 = Spring\n    2 = Summer\n    3 = Fall\nSpecies:\n    amin = Ammospermophilus interpres\n    amle = Ammospermophilus leucurus\n    eudo = Eutamias dorsalis\n    euqu = Eutamias quadrivittatus\n    spsp = Spermophilus spilosoma\n    spva = Spermophilus variegatus\n    chin = Chetodipus intermedius\n    pgfl = Perognathus flavescens\n    pgfv = Perognathus flavus\n    pgsp = Perognathus sp.\n    dime = Dipodomys merriami\n    dior = Dipodomys ordii\n    disp = Dipodomys spectabilis\n    dipo = Dipodomys sp.\n    neal = Neotoma albigula\n    nemi = Neotoma micropus\n    nesp = Neotoma sp.\n    onar = Onychomys arenicola\n    onle = Onychomys leucogaster\n    onsp = Onychomys sp.\n    pebo = Peromyscus boylii\n    pedi = Peromyscus difficilis\n    peer = Peromyscus eremicus\n    pele = Peromyscus leucopus\n    pema = Peromyscus maniculatus\n    petr = Peromyscus truei\n    pesp = Peromyscus sp.\n    remg = Reithrodontomys megalotis\n    remn = Reithrodontomys montanus\n    resp = Reithrodontomys sp.\n    sihi = Sigmodon hispidus\n    syau = Sylvilagus auduboni\n    na = unknown genus and species\n\n\n```{r libraries, include=F}\n# Load R packages which will be used in this script\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(plyr)\nlibrary(reshape2)\nlibrary(gridExtra)\nlibrary(cowplot)\nlibrary(knitr)\nlibrary(markdown)\nlibrary(xtable)\nlibrary(zoo)\nlibrary(tidyr)\nlibrary(stats)\nlibrary(car)\nlibrary(nlme)\nlibrary(visreg)\nlibrary(ggmap)\nlibrary(sp)\n```\n\n```{r}\n## Read in data (SEV-8, downloaded 26 Oct 2017)\nmammal.raw <- read.csv(\"~/Desktop/sev008_rodentpopns_20161027.csv\", strip.white=T)\nhead(mammal.raw)\nsummary(mammal.raw)\nsummary(mammal.raw$trap)\n\n## Fix some stuff\n# trap\nmammal.raw$trap[mammal.raw$trap %in% c(\"-999\", \"na\")] <- NA\n# recap - assume they're new\nmammal.raw$recap[mammal.raw$recap %in% c(\"\", \"na\")] <- \"n\"\n# sex\nmammal.raw$sex <- as.factor(tolower(as.character(mammal.raw$sex)))\nmammal.raw$sex[mammal.raw$sex %in% c(\"-999\", \"na\")] <- NA\nmammal.raw$sex[mammal.raw$sex %in% c(\"fm\")] <- \"f\"\n# age\nmammal.raw$age <- as.factor(tolower(as.character(mammal.raw$age)))\nmammal.raw$age[mammal.raw$age %in% c(\"-999\", \"na\")] <- NA\n# mass\nmammal.raw$mass[mammal.raw$mass %in% c(\"-999\", \"na\")] <- NA\nmammal.raw$mass <- as.numeric(mammal.raw$mass)\n\n```\n\n\n```{r}\n## Add columns\n# Habitat type\nmammal.raw$habitat <- revalue(mammal.raw$location, c(\n  \"5pgrass\" = \"grass\",\n  \"5plarrea\" = \"creosote\",\n  \"rsgrass\" = \"grass\",\n  \"rslarrea\" = \"creosote\",\n  \"two22\" = \"savanna\",\n  \"goatdraw\" = \"savanna\",\n  \"savanna\" = \"savanna\", \n  \"blugrama\" = \"grass\"))\n\n# Species, genera, feeding guilds, families\nmammal.raw$species.code <- mammal.raw$species\nmammal.raw$species.code <- revalue(mammal.raw$species.code, c(\n  \"pmbo\" = \"pebo\",\n  \"pmdi\" = \"pedi\",\n  \"pmer\" = \"peer\",\n  \"pmle\" = \"pele\",\n  \"pmma\" = \"pema\",\n  \"pmtr\" = \"petr\",\n  \"pmsp\" = \"pesp\"))\n\nmammal.raw$genus <- revalue(mammal.raw$species.code, c(\n  \"amin\" = \"Ammospermophilus\",\n  \"amle\" = \"Ammospermophilus\",\n  \"eudo\" = \"Tamias\",\n  \"euqu\" = \"Tamias\",\n  \"spsp\" = \"Spermophilus\",\n  \"spva\" = \"Spermophilus\",\n  \"chin\" = \"Chaetodipus\",\n  \"pgfl\" = \"Perognathus\",\n  \"pgfv\" = \"Perognathus\",\n  \"pgsp\" = \"Perognathus\",\n  \"dime\" = \"Dipodomys\",\n  \"dior\" = \"Dipodomys\",\n  \"disp\" = \"Dipodomys\",\n  \"dipo\" = \"Dipodomys\",\n  \"neal\" = \"Neotoma\",\n  \"nemi\" = \"Neotoma\",\n  \"nesp\" = \"Neotoma\",\n  \"onar\" = \"Onychomys\",\n  \"onle\" = \"Onychomys\",\n  \"onsp\" = \"Onychomys\",\n  \"pebo\" = \"Peromyscus\",\n  \"pedi\" = \"Peromyscus\",\n  \"peer\" = \"Peromyscus\",\n  \"pele\" = \"Peromyscus\",\n  \"pele\" = \"Peromyscus\",\n  \"pema\" = \"Peromyscus\",\n  \"petr\" = \"Peromyscus\",\n  \"pesp\" = \"Peromyscus\",\n  \"remg\" = \"Reithrodontomys\",\n  \"remn\" = \"Reithrodontomys\",\n  \"resp\" = \"Reithrodontomys\",\n  \"sihi\" = \"Sigmodon\",\n  \"syau\" = \"Sylvilagus\"))\n\nmammal.raw$species <- revalue(mammal.raw$species.code, c(\n  \"amin\" = \"Ammospermophilus interpres\",\n  \"amle\" = \"Ammospermophilus leucurus\",\n  \"eudo\" = \"Tamias dorsalis\",\n  \"euqu\" = \"Tamias quadrivittatus\",\n  \"spsp\" = \"Spermophilus spilosoma\",\n  \"spva\" = \"Spermophilus variegatus\",\n  \"chin\" = \"Chetodipus intermedius\",\n  \"pgfl\" = \"Perognathus flavescens\",\n  \"pgfv\" = \"Perognathus flavus\",\n  \"pgsp\" = \"Perognathus sp.\",\n  \"dime\" = \"Dipodomys merriami\",\n  \"dior\" = \"Dipodomys ordii\",\n  \"disp\" = \"Dipodomys spectabilis\",\n  \"dipo\" = \"Dipodomys sp.\",\n  \"neal\" = \"Neotoma albigula\",\n  \"nemi\" = \"Neotoma micropus\",\n  \"nesp\" = \"Neotoma sp.\",\n  \"onar\" = \"Onychomys arenicola\",\n  \"onle\" = \"Onychomys leucogaster\",\n  \"onsp\" = \"Onychomys sp.\",\n  \"pebo\" = \"Peromyscus boylii\",\n  \"pedi\" = \"Peromyscus difficilis\",\n  \"peer\" = \"Peromyscus eremicus\",\n  \"pele\" = \"Peromyscus leucopus\",\n  \"pema\" = \"Peromyscus maniculatus\",\n  \"petr\" = \"Peromyscus truei\",\n  \"pesp\" = \"Peromyscus sp.\",\n  \"remg\" = \"Reithrodontomys megalotis\",\n  \"remn\" = \"Reithrodontomys montanus\",\n  \"resp\" = \"Reithrodontomys sp.\",\n  \"sihi\" = \"Sigmodon hispidus\",\n  \"syau\" = \"Sylvilagus auduboni\"))\n\nmammal.raw$family <- revalue(mammal.raw$genus, c(\n  Perognathus = \"Heteromyidae\",\n  Reithrodontomys = \"Cricetidae\",\n  Dipodomys = \"Heteromyidae\",\n  Onychomys = \"Cricetidae\",\n  Spermophilus = \"Sciuridae\",\n  Neotoma = \"Cricetidae\",\n  Peromyscus = \"Cricetidae\",\n  Chaetodipus = \"Heteromyidae\",\n  Tamias = \"Sciuridae\",\n  Ammospermophilus = \"Sciuridae\",\n  Sigmodon  = \"Cricetidae\"))\n\n```\n\n```{r}\n# Summarize\nspecies.summary <- ddply(mammal.raw, c(\"year\", \"season\", \"location\", \"habitat\", \"family\", \"genus\", \"species\", \"species.code\"), function(x) data.frame(\n  total.new.cap = length(x$recap[x$recap == \"n\"]),\n  weight.new.cap = sum(x$mass[x$recap == \"n\"])))\n\ngenus.summary <- ddply(mammal.raw, c(\"year\", \"season\", \"location\", \"habitat\", \"family\", \"genus\"), function(x) data.frame(\n  total.new.cap = length(x$recap[x$recap == \"n\"]),\n  weight.new.cap = sum(x$mass[x$recap == \"n\"])))\n\nfamily.summary <- ddply(mammal.raw, c(\"year\", \"season\", \"location\", \"habitat\", \"family\"), function(x) data.frame(\n  total.new.cap = length(x$recap[x$recap == \"n\"]),\n  weight.new.cap = sum(x$mass[x$recap == \"n\"])))\n```\n\n\n```{r}\n## Timeline plots\nspecies.count.plot <- ggplot(species.summary[species.summary$season == 3,], aes(x=year, y=total.new.cap, group=interaction(species, location), colour=habitat, shape=habitat)) +\n  geom_line() + geom_point() + facet_wrap(~genus)\n\ngenus.count.plot <- ggplot(genus.summary[genus.summary$season == 3,], aes(x=year, y=log10(total.new.cap), group=interaction(genus, habitat), fill=habitat, shape=habitat)) +\n#  geom_line() + geom_point() + \n  geom_bar(stat=\"identity\", colour=\"black\") +\n  facet_wrap(~genus)\n```\n\n",
    "created" : 1509038889099.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "2781683523",
    "id" : "F2AC2FF",
    "lastKnownWriteTime" : 7877751749630255477,
    "last_content_update" : 1509047799881,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "chunk_output_type" : "console",
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}